---
title: ""
author: ""
date: ""
output: 
  html_document: 
    self_contained: no
    mathjax: null
    highlight: null
    toc: false
    css: slides.css
---


```{r echo = F, message=F, warning=F}
library(dplyr)

img_styles <- c("Duluth"          = "margin-top: -74px;",
                "Plymouth"        = "margin-top: -70px;",
                "Grand Portage"   = "margin-top: -15px;",
                "Grand Marais"    = "margin-top: -25px; margin-left: -20px",
                "St Paul"         = "margin-top: -90px;",
                "Bancroft (IA)"   = "margin-top: -55px;",
                "Sioux City (IA)" = "margin-top: -55px;",
                "Minneapolis"     = "margin-top: -45px;",
                "Mille Lacs"      = "margin-top: -45px;",
                "Preston"         = "margin-top: -35px;",
                "Truman"          = "margin-top: -35px;",
                "Boundary Waters" = "margin-bottom: -55px;",
                "Shorewood"       = "margin-bottom: -55px; margin-left: -20px")
 
print_slide <- function(img_class = "image", img_url, style = "margin-top: -15px;", city) {
  
  if(!is.null(city)) style <- img_styles[city][[1]]
  
  cat(paste0(c('<div class = "', img_class, '">',
             '<img src = "',   img_url, '"',
             ifelse(nchar(style) > 0, paste0(' style = "', style, '"'), ""),
             '></div> \n\n'), collapse = ""))
}

print_caption <- function(class = "caption", label) {
  cat(paste0(c('<div class = "', class, '">', label, '</div> \n'), collapse = ""))
}

# Update Bloom Sky

#source("R/update_bloom_sky.R")

bloom_sites <- read.csv("data/Bloom Sky site list.csv", stringsAsFactors = F)

# Clean city name
#bloom_sites$city <- gsub("[ ]", "-", bloom_sites$city)
bloom_sites$city <- gsub("[.]", "", bloom_sites$city)
```

<script type="text/JavaScript">
  setTimeout(function() { window.location=window.location; }, 300000);
</script>  

<div class = "box left">
<div class = "inner">

<span class = "titles">NATIONAL 
</span><span class= "titles sub"> Today&#39;s air quality 
</span>

<div class = "us-map">
<div style = "us-map-inner">           
<img src   = "https://files.airnowtech.org/airnow/today/anim_aqi_usa.gif" title="U.S. AQI Animation" 
     style = "width: 108%; margin-left: 4px; margin-right: 2px; margin-top: -20px;"border="0">
</div>
</div>

</div></div>


<div class = "box left-low">
<div class = "inner">

<span class = "titles">MINNESOTA</span>
<span class = "titles sub">Visibility</span>

<div id = "haze-cams">

```{r haze-cams, echo = FALSE, results = 'asis'}

for(i in unique(bloom_sites$group)[]) {
  
  cat('<div class = "haze-slides">')
  
  images <- filter(bloom_sites, group == i)
  
  print_slide(img_url = images$bloom_img[1], city = images$city[1])
  print_slide(img_url = images$bloom_img[2], city = images$city[2])
  
  print_caption(label = images$city[1])
  print_caption(label = images$city[2])
  
  print_slide(img_url = images$bloom_img[3], city = images$city[3])
  print_slide(img_url = images$bloom_img[4], city = images$city[4])
  
  print_caption(label = images$city[3])
  print_caption(label = images$city[4])
  cat("</div>")
}
```

</div>
</div></div>



<div class = "box right">
<div class = "inner">
 

<span class = "titles">MINNESOTA </span>
<span class = "titles sub">Current air quality</span>

<div class = "mn-map"> 
<div class = "mn-map-inner"> 
<iframe class = "map" src="https://mpca.sonomatechdata.com/reportingarea/contourMap" frameborder="0" style="width: 98%; height: 99%; margin-left:-35px; margin-bottom: -490px; "></iframe>

</div></div>



<div class = "aqi-trends"> 

<div id = "city-titles">

<div><span class = "titles slides">
ROCHESTER </span> <span class= "titles sub slides">
Today&#39;s air quality</span>
</div>

<div><span class = "titles slides">
TWIN CITIES </span> <span class= "titles sub slides">
Today&#39;s air quality</span>
</div>

<div><span class = "titles slides">
DULUTH </span> <span class= "titles sub slides">
Today&#39;s air quality</span>
</div>

</div>


<div style="margin-left: 0; margin-top: 45px; margin-bottom: 5px;">
<p class= "titles sub" style="font-weight: bold;"> Ozone </p>

<div id = "o3-trends">

<div><img class="slides" src="https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart.gif">
<img class="circle" style="left: -200px; top: 324px;" src="images/circle2-copy.png">
</div>

<div><img class="slides" src = "https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart2.gif">
<img class="circle" style="left: -235px; top: 262px;" src="images/circle2.png">
</div>

<div><img class="slides" src="https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart.gif">
<img class="circle" style="left: -183px; top: 135px;" src="images/circle2-copy.png">
</div>

</div>
</div>


<div style ="margin-left: 0; margin-top: 170px; margin-bottom: 5px;">
<p class = "titles sub" style ="font-weight: bold;"> PM2.5 </p>

<div id = "pm-trends">
<div><img class = "slides" src="https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart.gif"></div>
<div><img class = "slides" src="https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart2.gif"></div>
<div><img class = "slides" src="https://raw.githubusercontent.com/MPCA-air/aqi-trends/master/ozone_chart.gif"></div>
</div>
</div>

</div>

</div> </div>
            

<div class="box right-low">
<div class="inner">
            
<span class="titles">MINNESOTA</span>
<span class="titles sub">Air quality forecasts</span>

<div class = "forecast-map">
<span class= "titles sub" style="margin-left: 0px;"> 
`r weekdays(Sys.Date() + 1)` 
</span>
<img src="images/state_sites.PNG" style="border: 1px solid #a5a9ac; margin-left: 4px;">
</div>

<div class = "forecast-map">
<span class= "titles sub" style="margin-left: 0px;"> 
`r weekdays(Sys.Date() + 2)` 
</span>
<img src="images/state_sites2.PNG" style="border: 1px solid #a5a9ac; margin-left: 4px;">
</div>


```{r aqi-history, echo=F}
```
<div class = "aqi-history"> 

<div><span class = "titles slides">
2017 </span> <span class= "titles sub slides">
Site history by AQI color</span>
</div>

<div id = "aqi-days">

<div class = "day-slides"><img src = "images/history1.PNG" width="95%"></div>
<div class = "day-slides"><img src = "images/history2.PNG" width="95%"></div>
<div class = "day-slides"><img src = "images/history3.PNG" width="95%"></div>
<div class = "day-slides"><img src = "images/history4.PNG" width="95%"></div>

</div>

</div>
</div></div>


<script src="js/trend_slides.js"> </script>
<script src="js/haze-cams.js"> </script>
<script src="js/aqi-days.js"> </script>